trigger:
  tags:
    include:
      - "v*" # Trigger on version tags

jobs:
  - job: PublishPackages
    displayName: Publish Packages
    pool:
      vmImage: ubuntu-latest

    strategy:
      matrix:
        interfaces:
          packageName: interfaces
        grid_helpers:
          packageName: grid_helpers
        contingency_analysis:
          packageName: contingency_analysis
        dc_solver:
          packageName: dc_solver
        importer:
          packageName: importer
        topology_optimizer:
          packageName: topology_optimizer

    steps:
      - checkout: self
        clean: true

      - task: UsePythonVersion@0
        displayName: Configure Python version
        inputs:
          versionSpec: "3.11"

      - task: Bash@3
        displayName: Install uv
        inputs:
          targetType: inline
          script: |
            pipx install uv

      - script: |
          uv build
          uv publish --index MCCS --username __token__ --password $SYSTEM_ACCESS_TOKEN
        displayName: Publish $(packageName) package
        workingDirectory: packages/$(packageName)_pkg
        env:
          SYSTEM_ACCESS_TOKEN: $(System.AccessToken)
